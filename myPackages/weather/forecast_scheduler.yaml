input_button:
  get_forecasts:

automation:
  - alias: "Forecast scheduler"
    id: forecast_scheduler
    trigger:
      - platform: state
        entity_id: input_button.get_forecasts
      - platform: time_pattern
        minutes: "/30"
    action:
      - action: weather.get_forecasts
        target:
          entity_id: weather.forecast_home
        data:
          type: hourly
        response_variable: pronostico_home

      - service: python_script.forecast_processor
        data:
          location: "home"
          forecast: "{{ pronostico_home['weather.forecast_home']['forecast'] }}"

      - action: weather.get_forecasts
        target:
          entity_id: weather.forecast_work
        data:
          type: hourly
        response_variable: pronostico_work

      - service: python_script.forecast_processor
        data:
          location: "work"
          forecast: "{{ pronostico_work['weather.forecast_work']['forecast'] }}"
