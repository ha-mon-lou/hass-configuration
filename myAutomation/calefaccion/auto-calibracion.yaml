- id: "trv_despacho_external_temperature"
  alias: TRV Despacho - Temperatura externa
  description: "Envia la temperatura externa al TRV 03 en Z2M"
  mode: restart
  trigger:
    - platform: state
      entity_id: sensor.cfg_sensacion_termica_despacho
    - platform: time_pattern
      minutes: "/3"
  condition:
    - condition: state
      entity_id: input_boolean.invierno
      state: "on"
  action:
    - service: mqtt.publish
      data:
        topic: zigbee2mqtt/zigbee_sonoff_trvzb_03/set
        payload: >
          {
            "external_temperature_input": {{ states('sensor.cfg_sensacion_termica_despacho') | float }}
          }

- id: "trv_living1_external_temperature"
  alias: TRV Living 1 - Temperatura externa
  description: "Envia la temperatura externa al TRV 01 en Z2M"
  mode: restart
  trigger:
    - platform: state
      entity_id: sensor.cfg_sensacion_termica_living_1
    - platform: time_pattern
      minutes: "/3"
  condition:
    - condition: state
      entity_id: input_boolean.invierno
      state: "on"
  action:
    - service: mqtt.publish
      data:
        topic: zigbee2mqtt/zigbee_sonoff_trvzb_01/set
        payload: >
          {
            "external_temperature_input": {{ states('sensor.cfg_sensacion_termica_living_1') | float }}
          }

- id: "trv_living2_external_temperature"
  alias: TRV Living 2 - Temperatura externa
  description: "Envia la temperatura externa al TRV 04 en Z2M"
  mode: restart
  trigger:
    - platform: state
      entity_id: sensor.cfg_sensacion_termica_living_2
    - platform: time_pattern
      minutes: "/3"
  condition:
    - condition: state
      entity_id: input_boolean.invierno
      state: "on"
  action:
    - service: mqtt.publish
      data:
        topic: zigbee2mqtt/zigbee_sonoff_trvzb_04/set
        payload: >
          {
            "external_temperature_input": {{ states('sensor.cfg_sensacion_termica_living_2') | float }}
          }

- id: "trv_habitacion1_external_temperature"
  alias: TRV Habitacion 1 - Temperatura externa
  description: "Envia la temperatura externa al TRV 02 en Z2M"
  mode: restart
  trigger:
    - platform: state
      entity_id: sensor.cfg_sensacion_termica_habitacion_1
    - platform: time_pattern
      minutes: "/3"
  condition:
    - condition: state
      entity_id: input_boolean.invierno
      state: "on"
  action:
    - service: mqtt.publish
      data:
        topic: zigbee2mqtt/zigbee_sonoff_trvzb_02/set
        payload: >
          {
            "external_temperature_input": {{ states('sensor.cfg_sensacion_termica_habitacion_1') | float }}
          }
