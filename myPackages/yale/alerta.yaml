automation:
  - alias: Notificar puerta abierta m√°s de 10 minutos
    id: notificar_puerta_abierta_10min
    description: Env√≠a una notificaci√≥n si la puerta est√° abierta 10 minutos
    trigger:
      - platform: state
        entity_id: binary_sensor.puerta_principal_door_2
        to: "on"
        for: "00:10:00"
    condition:
      - condition: state
        entity_id: lock.puerta_principal_2
        state: "unlocked"
    action:
      - action: notify.mobile_app_sm_a155f
        data:
          title: "üö™ Puerta principal abierta"
          message: "La puerta lleva abierta m√°s de 10 minutos. ¬øQuieres cerrarla?"
          data:
            actions:
              - action: SABE_ABIERTA
                title: "S√≠, lo s√©"
              - action: CERRAR_PUERTA
                title: "Ci√©rrala ahora"

  - alias: Responder notificaci√≥n interactiva - cerrar puerta
    id: respuesta_cerrar_puerta
    description: Ejecuta el script para cerrar la puerta si el usuario pulsa "Ci√©rrala ahora"
    trigger:
      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: CERRAR_PUERTA
    condition:
      - condition: state
        entity_id: lock.puerta_principal_2
        state: "unlocked"
      - condition: state
        entity_id: binary_sensor.puerta_principal_door_2
        state: "on"
    action:
      - service: script.cerrar_puerta_principal

  - alias: Registrar respuesta "s√≠, lo s√©"
    id: respuesta_sabe_abierta
    description: Solo registra que el usuario lo sabe (opcional)
    trigger:
      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: SABE_ABIERTA
    action:
      - service: logbook.log
        data:
          name: "Puerta principal"
          message: "El usuario ha confirmado que sab√≠a que estaba abierta"
